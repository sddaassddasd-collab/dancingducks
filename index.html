<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dancing Ducks</title>
  <style>
    :root{
      --bg:#0b1e3a;
      --card:#0f254d;
      --glass: rgba(255,255,255,.08);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      background:var(--bg);
      color:#e5edf7;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial,sans-serif;
      display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    .row{
      width:min(1100px,96vw);
      display:grid;
      grid-template-columns: repeat(3,1fr);
      gap:20px;
    }
    .duck{
      background: linear-gradient(180deg,var(--card),#0b1e3a);
      border:1px solid var(--glass);
      border-radius: var(--radius);
      padding:18px 16px 14px;
      text-align:center;
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
    }
    .imgwrap{
      display:flex; justify-content:center; align-items:center;
      aspect-ratio: 1 / 1;
      overflow:hidden; border-radius:14px;
      background: rgba(255,255,255,.04);
    }
    .duck img{
      width: 85%; height:auto; user-select:none; -webkit-user-drag:none;
      will-change: transform;
    }

    /* Bob animation */
    @keyframes bob {
      0%   { transform: translateY(0) }
      50%  { transform: translateY(-8px) }
      100% { transform: translateY(0) }
    }
    .bob {
      animation: bob 1s ease-in-out infinite;
    }

    .controls{
      margin-top:12px;
      display:flex; justify-content:center; gap:8px;
    }
    .radio-btn{
      font-size: 28px; line-height:1;
      background: #18325f; border:1px solid var(--glass);
      border-radius: 999px; padding:10px 16px;
      cursor:pointer;
      box-shadow: 0 8px 24px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.05);
      transition: transform .08s ease, box-shadow .2s ease, background .2s ease;
    }
    .radio-btn:hover{ transform: translateY(-1px) }
    .radio-btn:active{ transform: translateY(0) scale(.98) }
    .label{
      font-size:14px; opacity:.8; margin-top:6px;
      letter-spacing:.02em;
    }

    @media (max-width: 900px){
      .row{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <main class="row">
    <!-- Duck 1 -->
    <section class="duck" data-id="1">
      <div class="imgwrap">
        <img src="duck1.png" alt="Duck 1" id="img-1">
      </div>
      <div class="controls">
        <button class="radio-btn" aria-label="Nhấn vào radio / Click the radio" data-audio="dance1.mp3" data-target="img-1" data-duration="22000">📻</button>
      </div>
      <div class="label">Nhấn vào radio · Click the radio</div>
      <audio id="audio-1" preload="auto">
        <source src="dance1.mp3" type="audio/mpeg">
      </audio>
    </section>

    <!-- Duck 2 -->
    <section class="duck" data-id="2">
      <div class="imgwrap">
        <img src="duck2.png" alt="Duck 2" id="img-2">
      </div>
      <div class="controls">
        <button class="radio-btn" aria-label="Nhấn vào radio / Click the radio" data-audio="dance2.mp3" data-target="img-2" data-duration="38000">📻</button>
      </div>
      <div class="label">Nhấn vào radio · Click the radio</div>
      <audio id="audio-2" preload="auto">
        <source src="dance2.mp3" type="audio/mpeg">
      </audio>
    </section>

    <!-- Duck 3 -->
    <section class="duck" data-id="3">
      <div class="imgwrap">
        <img src="duck3.png" alt="Duck 3" id="img-3">
      </div>
      <div class="controls">
        <button class="radio-btn" aria-label="Nhấn vào radio / Click the radio" data-audio="dance3.mp3" data-target="img-3" data-duration="14000">📻</button>
      </div>
      <div class="label">Nhấn vào radio · Click the radio</div>
      <audio id="audio-3" preload="auto">
        <source src="dance3.mp3" type="audio/mpeg">
      </audio>
    </section>
  </main>

  <script>
  const timeouts = new Map();

  function stopFor(button){
    const targetId = button.dataset.target;
    const img = document.getElementById(targetId);
    const card = button.closest('.duck');
    const duckId = card.dataset.id;
    const audioEl = document.getElementById('audio-' + duckId);

    if (audioEl){
      try{ audioEl.pause(); }catch(e){}
      try{ audioEl.currentTime = 0; }catch(e){}
      audioEl.onended = null;
    }

    if (timeouts.has(targetId)){
      clearTimeout(timeouts.get(targetId));
      timeouts.delete(targetId);
    }

    img.classList.remove('bob');
    button.dataset.playing = "0";
    button.textContent = "📻";
    button.setAttribute('aria-label', 'Nhấn vào radio / Click the radio');
  }

  function playFor(button){
    // 若已在播放則改為停止
    if (button.dataset.playing === "1"){
      stopFor(button);
      return;
    }

    const targetId = button.dataset.target;
    const audioSrc = button.dataset.audio;
    const duration = parseInt(button.dataset.duration || "15000", 10);
    const img = document.getElementById(targetId);
    const card = button.closest('.duck');
    const duckId = card.dataset.id;
    const audioEl = document.getElementById('audio-' + duckId);

    // 切換/載入聲音來源
    if (audioEl && audioEl.querySelector('source')?.getAttribute('src') !== audioSrc){
      audioEl.innerHTML = `<source src="${audioSrc}" type="audio/mpeg">`;
      audioEl.load();
    }

    // 播放音樂
    if (audioEl){
      try{ audioEl.pause(); audioEl.currentTime = 0; }catch(e){}
      audioEl.play().catch(()=>{});
      // 音檔播完後自動還原
      audioEl.onended = ()=> stopFor(button);
    }

    // 重置並啟動動畫
    if (timeouts.has(targetId)){
      clearTimeout(timeouts.get(targetId));
      timeouts.delete(targetId);
    }
    img.classList.remove('bob');
    void img.offsetWidth; // 重新觸發動畫
    img.classList.add('bob');

    // 標記為播放中＆改成停止圖示
    button.dataset.playing = "1";
    button.textContent = "⏹️";
    button.setAttribute('aria-label', 'Dừng phát / Stop');

    // 到時間自動停止與還原
    const t = setTimeout(()=>{
      stopFor(button);
    }, duration);
    timeouts.set(targetId, t);
  }

  document.addEventListener('click', (e)=>{
    const btn = e.target.closest('.radio-btn');
    if (!btn) return;
    playFor(btn);
  });
</script>
</body>
</html>
